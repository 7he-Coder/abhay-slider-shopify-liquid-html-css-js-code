{% comment %}
  ✅ Responsive Slider (Desktop & Mobile Paired)
  ✅ Uses lazy-loading for faster mobile performance
  ✅ Optimized with image_url sizing and aspect ratio control
  ✅ Single block pair per slide (desktop + mobile images)
{% endcomment %}

<section id="responsive-slider-{{ section.id }}" class="responsive-slider-section">
  <style>
    .responsive-slider-section {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
    }

    .slider-container {
      width: 100%;
      position: relative;
      overflow: hidden;
      aspect-ratio: 12 / 5;
    }

    .slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      transform: translateX(100%);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }

    .slide.active {
      opacity: 1;
      transform: translateX(0);
      z-index: 2;
    }

    .slide.previous {
      transform: translateX(-100%);
      z-index: 1;
    }

    .slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
    }

    /* Desktop images */
    .slide .desktop-img {
      display: block;
    }

    /* Mobile hidden by default */
    .slide .mobile-img {
      display: none;
    }

    /* On mobile */
    @media (max-width: 700px) {
      .slider-container {
        aspect-ratio: 9 / 12;
      }
      .slide .desktop-img {
        display: none;
      }
      .slide .mobile-img {
        display: block;
      }
    }

    /* Navigation Dots */
    .slider-dots {
      position: absolute;
      bottom: 5%;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 6px;
      z-index: 10;
    }

    .dot {
      cursor: pointer;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.7);
      transition: background 0.3s, transform 0.3s;
    }

    .dot.active {
      background-color: #fff;
      transform: scale(1.2);
    }

    /* Nav Arrows */
    .nav-btn {
      position: absolute;
      top: 88%;
      background: transparent;
      color: #fff;
      border: none;
      font-size: 60px;
      cursor: pointer;
      z-index: 20;
      transform: translateY(-50%);
    }

    .nav-btn.prev {
      left: 15px;
    }
    .nav-btn.next {
      right: 15px;
    }

    @media (max-width: 700px) {
      .nav-btn {
        font-size: 34px;
        padding: 8px 12px;
      }
      .slider-dots {
        bottom: 4%;
        gap: 5px;
      }
      .dot {
        width: 8px;
        height: 8px;
      }
    }
  </style>

  <div class="slider-container">
    {% for block in section.blocks %}
      <div class="slide {% if forloop.first %}active{% endif %}">
        {% if block.settings.desktop_image != blank %}
          <img
            width=""
            height=""
            class="desktop-img"
            src="{{ block.settings.desktop_image | image_url: width: 2000 }}"
            alt="Desktop Image {{ forloop.index }}"
            loading="lazy"
          >
        {% endif %}

        {% if block.settings.mobile_image != blank %}
          <img
            width=""
            height=""
            class="mobile-img"
            src="{{ block.settings.mobile_image | image_url: width: 768 }}"
            alt="Mobile Image {{ forloop.index }}"
            loading="lazy"
          >
        {% endif %}
      </div>
    {% endfor %}

    <div class="slider-dots" id="dots-{{ section.id }}"></div>
    <button class="nav-btn prev" id="prev-{{ section.id }}">&#8592;</button>
    <button class="nav-btn next" id="next-{{ section.id }}">&#8594;</button>
  </div>

  <script>
    (function () {
      const sectionId = '{{ section.id }}';
      const slides = document.querySelectorAll(`#responsive-slider-${sectionId} .slide`);
      const dotsContainer = document.getElementById(`dots-${sectionId}`);
      const prevBtn = document.getElementById(`prev-${sectionId}`);
      const nextBtn = document.getElementById(`next-${sectionId}`);
      let current = 0;
      const interval = 4000;
      let timer;

      slides.forEach((_, i) => {
        const dot = document.createElement('span');
        dot.classList.add('dot');
        dot.addEventListener('click', () => changeSlide(i));
        dotsContainer.appendChild(dot);
      });

      const dots = dotsContainer.querySelectorAll('.dot');
      dots[current].classList.add('active');

      function changeSlide(index) {
        slides.forEach((slide, i) => {
          slide.classList.remove('active', 'previous');
          dots[i].classList.remove('active');
        });
        const prev = current;
        current = (index + slides.length) % slides.length;
        slides[current].classList.add('active');
        slides[prev].classList.add('previous');
        dots[current].classList.add('active');
      }

      function nextSlide() {
        changeSlide(current + 1);
      }
      function prevSlide() {
        changeSlide(current - 1);
      }

      nextBtn.addEventListener('click', () => {
        nextSlide();
        resetTimer();
      });
      prevBtn.addEventListener('click', () => {
        prevSlide();
        resetTimer();
      });

      function startTimer() {
        timer = setInterval(() => changeSlide(current + 1), interval);
      }

      function resetTimer() {
        clearInterval(timer);
        startTimer();
      }

      startTimer();
    })();
  </script>
</section>

{% schema %}
{
  "name": "Responsive Slider",
  "settings": [],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "desktop_image",
          "label": "Desktop Image"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "abhay-hero-slider",
      "category": "Custom Sections"
    }
  ]
}
{% endschema %}
